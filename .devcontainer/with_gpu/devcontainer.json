{
	"name": "workspace-with-gpu",
	"build": {		  
		"dockerfile": "Dockerfile",
		"context": ".",
		"args": {
			"USER": "${localEnv:USER}"
		}
	},
	"customizations": {
		"vscode": {
			"settings": {
				"rubyLsp.bundleGemfile": ".devcontainer/with_gpu/Gemfile"
			},
			"extensions": [
				"rooveterinaryinc.roo-cline",
				"ms-azuretools.vscode-docker",
				"ms-python.python",
				"ms-python.black-formatter",
				"shopify.ruby-extensions-pack",
				"hashicorp.terraform"
			]
		}
	},
	"workspaceFolder": "/home/${localEnv:USER}/workspace",
	"workspaceMount": "source=${localWorkspaceFolder},target=/home/${localEnv:USER}/workspace,type=bind,consistency=cached",
	"mounts": [
		"source=${localEnv:HOME}/.ssh,target=/tmp/.ssh,type=bind,consistency=cached",
		"source=${localEnv:HOME}/.aws,target=/home/${localEnv:USER}/.aws,type=bind,consistency=cached",
		"source=${localEnv:HOME}/.openstack,target=/home/${localEnv:USER}/.openstack,type=bind,consistency=cached",
		"source=${localEnv:HOME}/.vscode-dind,target=/var/lib/docker,type=bind,consistency=cached"
	],
	"containerUser": "root",
	"remoteUser": "${localEnv:USER}",
	"overrideCommand": false,
	"privileged": true,
	"initializeCommand": [
		"mkdir",
		"-p",
		"${localEnv:HOME}/.ssh/",
		"${localEnv:HOME}/.aws",
		"${localEnv:HOME}/.openstack",
		"${localEnv:HOME}/.vscode-dind"
	],
	"onCreateCommand": [
		"bash",
		"-c",
		"sudo cp -r /tmp/.ssh /home/${localEnv:USER}/.ssh && sudo chown ${localEnv:USER}:${localEnv:USER} -R /home/${localEnv:USER}/.ssh && sudo chmod 700 /home/${localEnv:USER}/.ssh && sudo chmod 600 /home/${localEnv:USER}/.ssh/*"
	],
	"runArgs": [
		"--gpus",
		"all"
	]
}
